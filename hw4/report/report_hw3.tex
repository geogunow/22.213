\documentclass[12pt]{report}
\usepackage{scribe,graphicx,graphics}
\usepackage{subcaption}


\course{MIT 22.213} 	
\coursetitle{Nuclear Reactor Kinetics}	
\semester{Spring 2015}
\lecturenumber{3}	
\lecturedate{}		


% Insert your name here!
\scribe{Geoffrey Gunow}

\begin{document}
	
	
	\maketitle
	
	\paragraph{Intro: Code Design}

	\begin{eqnarray}
	\frac{\partial}{\partial t} \left\langle \frac{1}{v_g(\vec{r},t)} \phi_g(\vec{r},t) \right\rangle = \nabla D_g(\vec{r},t) \nabla \phi_g(\vec{r},t) - \Sigma_{t,g}(\vec{r},t) \phi_g(\vec{r},t) + \sum_{g'=1}^{G} \Sigma_{s}^{g'\rightarrow g} (\vec{r},t) \phi_{g'}(\vec{r},t) \nonumber \\ 
	+ \left[ 1- \beta(\vec{r},t) \right] \frac{\chi_g^p}{k_{crit}} \sum_{g'=1}^{G} \nu \Sigma_{f,g'}(\vec{r},t) \phi_{g'}(\vec{r},t) + \sum_{i=1}^{I} \chi_{i,g}^d \lambda_i C_i(\vec{r},t) \nonumber
	\end{eqnarray}
	Assume no leakage
		\begin{eqnarray}
		\frac{\partial}{\partial t} \left\langle \frac{1}{v_g(\vec{r},t)} \phi_g(\vec{r},t) \right\rangle = - \Sigma_{t,g}(\vec{r},t) \phi_g(\vec{r},t) + \sum_{g'=1}^{G} \Sigma_{s}^{g'\rightarrow g} (\vec{r},t) \phi_{g'}(\vec{r},t) \nonumber \\ 
		+ \left[ 1- \beta(\vec{r},t) \right] \frac{\chi_g^p}{k_{crit}} \sum_{g'=1}^{G} \nu \Sigma_{f,g'}(\vec{r},t) \phi_{g'}(\vec{r},t) + \sum_{i=1}^{I} \chi_{i,g}^d \lambda_i C_i(\vec{r},t) \nonumber
		\end{eqnarray}
	Change to siga and sigs	and assume $v_g$ is constant, assume $\beta$ is constant
	
	\begin{eqnarray}
	\frac{\partial}{\partial t} \left( \frac{1}{v_g} \phi_g(\vec{r},t) \right) = - \Sigma_{a,g}(\vec{r},t) \phi_g(\vec{r},t) - \sum_{g'\neq g} \Sigma_{s}^{g\rightarrow g'} (\vec{r},t) \phi_{g}(\vec{r},t) + \sum_{g' \neq g} \Sigma_{s}^{g'\rightarrow g} (\vec{r},t) \phi_{g'}(\vec{r},t) \nonumber \\ 
	+ \left[ 1- \beta \right] \frac{\chi_g^p}{k_{crit}} \sum_{g'=1}^{G} \nu \Sigma_{f,g'}(\vec{r},t) \phi_{g'}(\vec{r},t) + \sum_{i=1}^{I} \chi_{i,g}^d \lambda_i C_i(\vec{r},t) \nonumber
	\end{eqnarray}
	
	Transform $\phi_g(\vec{r},t) \rightarrow S_g(\vec{r}) T_g(t)$:
	
		\begin{eqnarray}
		\frac{\partial}{\partial t} \left( \frac{1}{v_g}  S_g(\vec{r}) T_g(t) \right) = - \Sigma_{a,g}(\vec{r},t)  S_g(\vec{r}) T_g(t) - \sum_{g' \neq g} \Sigma_{s}^{g\rightarrow g'} (\vec{r},t)  S_g(\vec{r}) T_g(t) \nonumber \\  + \sum_{g' \neq g} \Sigma_{s}^{g'\rightarrow g} (\vec{r},t)  S_{g'}(\vec{r}) T_{g'}(t) 	+ \left[ 1- \beta \right] \frac{\chi_g^p}{k_{crit}} \sum_{g'=1}^{G} \nu \Sigma_{f,g'}(\vec{r},t) S_{g'}(\vec{r}) T_{g'}(t) \nonumber \\ +
		 \sum_{i=1}^{I} \chi_{i,g}^d \lambda_i C_i(\vec{r},t)
		\end{eqnarray}
		
	Rearranging terms:
	\begin{eqnarray} 
	\frac{\partial T_g(t)}{\partial t} \left( \frac{1}{v_g}  S_g(\vec{r}) \right) = - \Sigma_{a,g}(\vec{r},t)  S_g(\vec{r}) T_g(t) - \sum_{g'\neq g} \left( \Sigma_{s}^{g\rightarrow g'}(\vec{r},t) \right)  S_g(\vec{r}) T_g(t) \nonumber \\  + \sum_{g'\neq g} \left( \Sigma_{s}^{g'\rightarrow g} (\vec{r},t)  S_{g'}(\vec{r}) T_{g'}(t) \right) + \left[ 1- \beta \right] \frac{\chi_g^p}{k_{crit}} \sum_{g'=1}^{G} \left( \nu \Sigma_{f,g'}(\vec{r},t) S_{g'}(\vec{r}) T_{g'}(t) \right) \nonumber \\ +
	\sum_{i=1}^{I} \left( \chi_{i,g}^d \lambda_i C_i(\vec{r},t) \right)
	\end{eqnarray}
	
	Multiply by the adjoint and integrate:
	\begin{eqnarray} 
	\frac{\partial T_g(t)}{\partial t} \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \frac{1}{v_g}  S_g(\vec{r}) \right) = - \int_{V} d\vec{r} \phi_g^*(\vec{r}) \Sigma_{a,g}(\vec{r},t)  S_g(\vec{r}) T_g(t) \nonumber \\
	- \int_{V} d\vec{r} \phi_g^*(\vec{r}) \sum_{g'\neq g} \left( \Sigma_{s}^{g\rightarrow g'}(\vec{r},t) \right)  S_g(\vec{r}) T_g(t) \nonumber \\
	  + \int_{V} d\vec{r} \phi_g^*(\vec{r}) \sum_{g'\neq g} \left( \Sigma_{s}^{g'\rightarrow g} (\vec{r},t)  S_{g'}(\vec{r}) T_{g'}(t) \right) \nonumber \\
	  + \int_{V} d\vec{r} \phi_g^*(\vec{r}) \left[ 1- \beta \right] \frac{\chi_g^p}{k_{crit}} \sum_{g'=1}^{G} \left( \nu \Sigma_{f,g'}(\vec{r},t) S_{g'}(\vec{r}) T_{g'}(t) \right) \nonumber \\ +
	\int_{V} d\vec{r} \phi_g^*(\vec{r}) \sum_{i=1}^{I} \left( \chi_{i,g}^d \lambda_i C_i(\vec{r},t) \right)
	\end{eqnarray}
	
	Group terms:
		\begin{eqnarray} 
		\frac{\partial T_g(t)}{\partial t} \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \frac{1}{v_g}  S_g(\vec{r}) \right) = - \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \Sigma_{a,g}(\vec{r},t)  S_g(\vec{r}) \right) T_g(t) \nonumber \\
		- \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \sum_{g'\neq g} \left( \Sigma_{s}^{g\rightarrow g'}(\vec{r},t) \right)  S_g(\vec{r}) \right) T_g(t) \nonumber \\
		+ \sum_{g'\neq g} \left( \left( \int_{V}  d\vec{r} \phi_g^*(\vec{r})  \Sigma_{s}^{g'\rightarrow g} (\vec{r},t)  S_{g'}(\vec{r}) \right) T_{g'}(t) 
		\right) \nonumber \\
		+ \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \left[ 1- \beta \right] \frac{\chi_g^p}{k_{crit}} \sum_{g'=1}^{G} \left( \nu \Sigma_{f,g'}(\vec{r},t) S_{g'}(\vec{r}) T_{g'}(t) \right) \right) \nonumber \\ +
		\sum_{i=1}^{I} \left( \int_{V} d\vec{r} \phi_g^*(\vec{r})  \chi_{i,g}^d \lambda_i C_i(\vec{r},t) \right)
		\end{eqnarray}
	
	Now turning to precursors:
	\begin{equation}
	\frac{\partial}{\partial t} C_i(\vec{r},t) = -\lambda_i C_i(\vec{r},t) + \frac{\beta_i(\vec{r},t)}{k_{crit}} \sum_{g'=1}^{G} \nu \Sigma_{f,g'}(\vec{r},t) \phi_{g'}(\vec{r},t)
	\end{equation}
	which again we take $\beta$ to be constant:
	\begin{equation}
	\frac{\partial}{\partial t} C_i(\vec{r},t) = -\lambda_i C_i(\vec{r},t) + \frac{\beta_i}{k_{crit}} \sum_{g'=1}^{G} \nu \Sigma_{f,g'}(\vec{r},t) \phi_{g'}(\vec{r},t)
	\end{equation}
	Multiply by the adjoint with delayed neutron emission spectrum and integrate over space (assuming $\chi^d_{i,g}$ is constant):
	\begin{eqnarray}
	\frac{\partial}{\partial t} \left( \int_{V} d\vec{r} \chi^d_{i,g} \phi_g^*(\vec{r}) C_i(\vec{r},t) \right)= -\lambda_i \int_{V} d\vec{r} \chi^d_{i,g} \phi_g^*(\vec{r}) C_i(\vec{r},t) \nonumber \\
	 + \frac{\beta_i}{k_{crit}} \sum_{g'=1}^{G}\left( \int_{V} d\vec{r} \chi^d_{i,g} \phi_g^*(\vec{r}) \nu \Sigma_{f,g'}(\vec{r},t) \phi_{g'}(\vec{r},t) \right)
	\end{eqnarray}
	For convenience we let 
	\begin{equation}
	\tilde{C}_i^g(t) = \int_{V} d\vec{r} \, \chi^d_{i,g} \phi_g^*(\vec{r}) C_i(\vec{r},t) 
	\end{equation}
	Which reduces our equations to
		\begin{eqnarray}
		\frac{\partial}{\partial t} \tilde{C}_i^g(t) = -\lambda_i \tilde{C}_i^g(t) + \frac{\beta_i}{k_{crit}} \sum_{g'=1}^{G}\left( \int_{V} d\vec{r} \chi^d_{i,g} \phi_g^*(\vec{r}) \nu \Sigma_{f,g'}(\vec{r},t) \phi_{g'}(\vec{r},t) \right)
		\end{eqnarray}
	
	Bringing back the notation from the diffusion PKE:
	\begin{eqnarray}
	\frac{\partial}{\partial t} \tilde{C}_i^g(t) = -\lambda_i \tilde{C}_i^g(t) + \frac{\beta_i}{k_{crit}} \sum_{g'=1}^{G}\left( \left( \int_{V} d\vec{r} \chi^d_{i,g} \phi_g^*(\vec{r}) \nu \Sigma_{f,g'}(\vec{r},t) S_{g'}(\vec{r}) \right) T_{g'}(t) \right)
	\end{eqnarray}
	
	Returning to the diffusion equation:
	\begin{eqnarray} 
	\frac{\partial T_g(t)}{\partial t} \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \frac{1}{v_g}  S_g(\vec{r}) \right) = - \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \Sigma_{a,g}(\vec{r},t)  S_g(\vec{r}) \right) T_g(t) \nonumber \\
	- \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \sum_{g'\neq g} \left( \Sigma_{s}^{g\rightarrow g'}(\vec{r},t) \right)  S_g(\vec{r}) \right) T_g(t) \nonumber \\
	+ \sum_{g'\neq g} \left( \left( \int_{V}  d\vec{r} \phi_g^*(\vec{r})  \Sigma_{s}^{g'\rightarrow g} (\vec{r},t)  S_{g'}(\vec{r}) \right) T_{g'}(t) 
	\right) \nonumber \\
	+ \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \left[ 1- \beta \right] \frac{\chi_g^p}{k_{crit}} \sum_{g'=1}^{G} \left( \nu \Sigma_{f,g'}(\vec{r},t) S_{g'}(\vec{r}) T_{g'}(t) \right) \right) +
	\sum_{i=1}^{I} \left( \lambda_i \tilde{C}_i^g(t) \right)
	\end{eqnarray}
	
	Now we make a simple approximation of the time derivative:
	
	\begin{eqnarray} 
	\frac{ T_g(t_{n+1}) - T_g(t_{n})}{\Delta t} \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \frac{1}{v_g}  S_g(\vec{r}) \right) = \nonumber \\
	 - \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \Sigma_{a,g}(\vec{r},t_{n+1})  S_g(\vec{r}) \right) T_g(t_{n+1}) \nonumber \\
	- \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \sum_{g'\neq g} \left( \Sigma_{s}^{g\rightarrow g'}(\vec{r},t_{n+1}) \right)  S_g(\vec{r}) \right) T_g(t_{n+1}) \nonumber \\
	+ \sum_{g'\neq g} \left( \left( \int_{V}  d\vec{r} \phi_g^*(\vec{r})  \Sigma_{s}^{g'\rightarrow g} (\vec{r},t_{n+1})  S_{g'}(\vec{r}) \right) T_{g'}(t_{n+1}) 
	\right) \nonumber \\
	+ \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \left[ 1- \beta \right] \frac{\chi_g^p}{k_{crit}} \sum_{g'=1}^{G} \left( \nu \Sigma_{f,g'}(\vec{r},t_{n+1}) S_{g'}(\vec{r}) T_{g'}(t_{n+1}) \right) \right) \nonumber \\
	 + \sum_{i=1}^{I} \left( \lambda_i \tilde{C}_i^g(t_{n+1}) \right)
	\end{eqnarray}
	
	Similarly for the precursors:
	\begin{eqnarray}
	\frac{\tilde{C}_i^g(t_{n+1}) - \tilde{C}_i^g(t_{n})}{\Delta t} = -\lambda_i \tilde{C}_i^g(t_{n+1}) \nonumber \\
	 + \frac{\beta_i}{k_{crit}} \sum_{g'=1}^{G}\left( \left( \int_{V} d\vec{r} \chi^d_{i,g} \phi_g^*(\vec{r}) \nu \Sigma_{f,g'}(\vec{r},t_{n+1}) S_{g'}(\vec{r}) \right) T_{g'}(t_{n+1}) \right)
	\end{eqnarray}
	
	Solving for $\tilde{C}_i^g(t_{n+1})$:
	
	\begin{eqnarray}
	\tilde{C}_i^g(t_{n+1}) = \frac{\tilde{C}_i^g(t_{n})}{1+\lambda_i \Delta t}  \nonumber \\
	+ \frac{\beta_i \Delta t}{k_{crit}\left(1+\lambda_i \Delta t\right)} \sum_{g'=1}^{G}\left( \left( \int_{V} d\vec{r} \chi^d_{i,g} \phi_g^*(\vec{r}) \nu \Sigma_{f,g'}(\vec{r},t_{n+1}) S_{g'}(\vec{r}) \right) T_{g'}(t_{n+1}) \right)
	\end{eqnarray}
	
	Combining these equations,
		\begin{eqnarray} 
		\frac{ T_g(t_{n+1}) - T_g(t_{n})}{\Delta t} \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \frac{1}{v_g}  S_g(\vec{r}) \right) = \nonumber \\
		- \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \Sigma_{a,g}(\vec{r},t_{n+1})  S_g(\vec{r}) \right) T_g(t_{n+1}) \nonumber \\
		- \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \sum_{g'\neq g} \left( \Sigma_{s}^{g\rightarrow g'}(\vec{r},t_{n+1}) \right)  S_g(\vec{r}) \right) T_g(t_{n+1}) \nonumber \\
		+ \sum_{g'\neq g} \left( \left( \int_{V}  d\vec{r} \phi_g^*(\vec{r})  \Sigma_{s}^{g'\rightarrow g} (\vec{r},t_{n+1})  S_{g'}(\vec{r}) \right) T_{g'}(t_{n+1}) 
		\right) \nonumber \\
		+ \left( \int_{V} d\vec{r} \phi_g^*(\vec{r}) \left[ 1- \beta \right] \frac{\chi_g^p}{k_{crit}} \sum_{g'=1}^{G} \left( \nu \Sigma_{f,g'}(\vec{r},t_{n+1}) S_{g'}(\vec{r}) T_{g'}(t_{n+1}) \right) \right) \nonumber \\
		+ \sum_{i=1}^{I} \left( \frac{\beta_i \lambda_i \Delta t}{k_{crit}\left(1+\lambda_i \Delta t\right)} \sum_{g'=1}^{G}\left( \left( \int_{V} d\vec{r} \chi^d_{i,g} \phi_g^*(\vec{r}) \nu \Sigma_{f,g'}(\vec{r},t_{n+1}) S_{g'}(\vec{r}) \right) T_{g'}(t_{n+1}) \right) \right) \nonumber \\
		+ \sum_{i=1}^{I} \frac{\lambda_i \tilde{C}_i^g(t_{n})}{1+\lambda_i \Delta t} \nonumber
		\end{eqnarray}
		
		Now that we have the full form of the equation we wish to solve, let us define some terms to simplify the expressions:
		
		
		\begin{eqnarray}
		R_{t,g} = \int_{V} d\vec{r} \, \phi_g^*(\vec{r}) \frac{1}{v_g}  S_g(\vec{r}) \\
		R_{a,g} = \int_{V} d\vec{r} \, \phi_g^*(\vec{r}) \Sigma_{a,g}(\vec{r},t_{n+1})  S_g(\vec{r}) \\
		R_{so,g} = \int_{V} d\vec{r} \, \phi_g^*(\vec{r}) \sum_{g'\neq g} \left( \Sigma_{s}^{g\rightarrow g'}(\vec{r},t_{n+1}) \right)  S_g(\vec{r}) \\
		R_{s}^{g'\rightarrow g} = \int_{V}  d\vec{r} \, \phi_g^*(\vec{r})  \Sigma_{s}^{g'\rightarrow g} (\vec{r},t_{n+1})  S_{g'}(\vec{r}) \\
		R_{f}^{g' \rightarrow g} = \int_{V} d\vec{r} \, \phi_g^*(\vec{r}) \left[ 1- \beta \right] \frac{\chi_g^p}{k_{crit}} \nu \Sigma_{f,g'}(\vec{r},t_{n+1}) S_{g'}(\vec{r}) \\
		R_{p,i}^{g' \rightarrow g} = \int_{V} d\vec{r} \, \chi^d_{i,g} \phi_g^*(\vec{r}) \nu \Sigma_{f,g'}(\vec{r},t_{n+1}) S_{g'}(\vec{r})
		\end{eqnarray}
		
		This reduces our equations to:
		
		\begin{eqnarray} 
		\frac{ T_g(t_{n+1}) - T_g(t_{n})}{\Delta t} R_{t,g} = - \left( R_{a,g} + R_{so,g} \right) T_g(t_{n+1}) + \sum_{g'\neq g}^{G} R_s^{g' \rightarrow g} T_{g'}(t_{n+1}) \nonumber \\
		+ \sum_{g'=1}^{G} R_f^{g' \rightarrow g} T_{g'}(t_{n+1}) + \sum_{i=1}^{I} \left( \frac{\beta_i \lambda_i \Delta t}{k_{crit}\left(1+\lambda_i \Delta t\right)} \sum_{g'=1}^{G} R_{p,i}^{g' \rightarrow g} T_{g'}(t_{n+1}) \right) + \sum_{i=1}^{I} \frac{\lambda_i \tilde{C}_i^g(t_{n})}{1+\lambda_i \Delta t}
		\end{eqnarray}
		

		
		\begin{eqnarray} 
		\frac{R_{t,g} T_g(t_{n})}{\Delta t} = \left( R_{a,g} + R_{so,g} + \frac{R_{t,g}}{\Delta t} \right) T_g(t_{n+1}) - \sum_{g'\neq g}^{G} R_s^{g' \rightarrow g} T_{g'}(t_{n+1}) \nonumber \\
		- \sum_{g'=1}^{G} R_f^{g' \rightarrow g} T_{g'}(t_{n+1}) - \sum_{i=1}^{I} \left( \frac{\beta_i \lambda_i}{k_{crit}\left(1+\lambda_i \right)} \sum_{g'=1}^{G} R_{p,i}^{g' \rightarrow g} T_{g'}(t_{n+1}) \right) - \nonumber \\
		\sum_{i=1}^{I} \frac{\lambda_i \tilde{C}_i^g(t_{n})}{1+\lambda_i \Delta t}
		\end{eqnarray}	
		
		This eventually leads to our final expressions:
		
		\begin{eqnarray} 
		\frac{R_{t,g} T_g(t_{n})}{\Delta t} + \sum_{i=1}^{I} \frac{\lambda_i \tilde{C}_i^g(t_{n})}{1+\lambda_i \Delta t} = \left( R_{a,g} + R_{so,g} + \frac{R_{t,g}}{\Delta t} \right) T_g(t_{n+1}) \nonumber \\ - \sum_{g'\neq g}^{G} R_s^{g' \rightarrow g} T_{g'}(t_{n+1}) - \sum_{g'=1}^{G} R_f^{g' \rightarrow g} T_{g'}(t_{n+1}) \nonumber \\ - \sum_{i=1}^{I} \left( \frac{\beta_i \lambda_i}{k_{crit}\left(1+\lambda_i \right)} \sum_{g'=1}^{G} R_{p,i}^{g' \rightarrow g} T_{g'}(t_{n+1}) \right)
		\end{eqnarray}	
		
		and to calculate the precursors:
	
	\begin{eqnarray}
	\tilde{C}_i^g(t_{n+1}) = \frac{\tilde{C}_i^g(t_{n})}{1+\lambda_i \Delta t}  + \frac{\beta_i \Delta t}{k_{crit}\left(1+\lambda_i \Delta t\right)} \sum_{g'=1}^{G} R_{p,i}^{g' \rightarrow g} T_{g'}(t_{n+1})
	\end{eqnarray}
	
	For calculating initial precursors, it is important to remember:
	\begin{equation}
	\tilde{C}_i^g(t) = \int_{V} d\vec{r} \, \chi^d_{i,g} \phi_g^*(\vec{r}) C_i(\vec{r},t) 
	\end{equation}
			
		
		
\end{document}